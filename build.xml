<project name="clojurecheck" default="jar">

	<description>
		Build with "ant jar".
	</description>

	<property environment="env"/>

	<property name="src" location="src"/>
	<property name="build" location="classes"/>
	<property name="clojurecheck_jar" location="clojurecheck.jar"/>
	<property name="clojure.lib" location="${env.CLOJURE_LIB}"/>

	<path id="clojurelib">
		<fileset dir="${clojure.lib}" includes="**/*.jar"/>
	</path>

	<target name="init">
		<tstamp/>
		<mkdir dir="${build}"/>
	</target>

	<target name="aot" depends="init"
		description="Compile Clojure sources.">
		<java classname="clojure.lang.Compile">
			<classpath>
				<path location="${build}"/>
				<path location="${src}"/>
				<path refid="clojurelib"/>
			</classpath>
			<sysproperty key="clojure.compile.path"
				value="${build}"/>
			<arg value="de.kotka.clojurecheck.FatalTestError"/>
			<arg value="de.kotka.clojurecheck"/>
		</java>
	</target>

	<target name="jar" depends="aot"
		description="Create jar file.">
		<jar jarfile="${clojurecheck_jar}">
			<path location="README.txt"/>
			<path location="LICENSE.txt"/>
			<fileset dir="${src}" includes="**/*.clj"/>
			<!-- make sure we don't include any dependencies -->
			<fileset dir="${build}" includes="de/kotka/**/*.class"/>
			<manifest>
				<attribute name="Class-Path" value="."/>
			</manifest>
		</jar>
	</target>

	<target name="clean"
		description="Remove autogenerated files and directories.">
		<delete dir="${build}"/>
		<delete file="${clojurecheck_jar}"/>
	</target>

</project>
